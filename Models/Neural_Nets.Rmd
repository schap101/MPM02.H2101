---
title: "Neural Net"
output: html_notebook
author: ""
---


Load libraries and data set

```{r, echo= FALSE}
library(tidyverse)
library(neuralnet)
library(caret)
library(rstudioapi)
library(rmarkdown)
library(dplyr)
```

```{r, echo= FALSE}
setwd(dirname(getActiveDocumentContext()$path))
df <- read.csv("../Data/hour.csv")
```


--------------------------------------------------------------------------------
Inspect df

food <- factor(food, levels = c("low", "medium", "high"), ordered = TRUE)
df$season <- as.factor(df$season)
```{r, echo= FALSE}
df$season <- factor(df$season, levels = c("1", "2", "3", "4"), ordered = TRUE)
df$yr <- as.factor(df$yr)
df$mnth <- as.factor(df$mnth)
df$hr <- as.factor(df$hr)
df$holiday <- as.factor(df$holiday)
df$weekday <- as.factor(df$weekday)
df$workingday <- as.factor(df$workingday)
df$weathersit <- as.factor(df$weathersit)
```


```{r, echo= FALSE}
str(df)
```



--------------------------------------------------------------------------------
Split data train/test

```{r}
set.seed(123)
indices <- createDataPartition(df$cnt, p=.8, list = F)

train <- df %>% slice(indices)
test <- df %>% slice(-indices)

str(train)
```


--------------------------------------------------------------------------------
Train model

```{r}
glimpse(head(df))
```

```{r}
set.seed(42)
df_net = neuralnet(cnt ~ temp + windspeed + season, train, hidden=c(4,3))
```



```{r}
plot(df_net, information = T, show.weights = T)
```

```{r}
pred <- compute(df_net, test %>% select(-hr))
pred$net.result
```
```{r}
plot(test$cnt, col='blue', pch=1, ylab = "predicted rating NN", xlab = "real rating")
```

```{r}
sqrt(mean((test$cnt - pred)^2))
```


--------------------------------------------------------------------------------
With caret - maybe better?

```{r}
set.seed(42)
tuGrid <- expand.grid(.layer1=c(1:4), .layer2=c(0:4), .layer3=c(0:4))

trCtrl <- trainControl(
  method = 'repeatedcv',
  number = 5,
  repeats = 2,
  returnResamp = 'final'
)
```

```{r}
models <- train(
  x = df %>% select(-cnt),
  y = df %>% pull(cnt),
  method = 'neuralnet', metric = 'RMSE',
  linear.output = TRUE,
  preProcess = c('center', 'scale'),
  tuneGrid = tuGrid,
  trControl = trCtrl
  )
```
```{r}
plot(models)
```





